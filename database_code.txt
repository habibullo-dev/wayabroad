import pandas as pd
import json
import os

# Define the directory where the files are located
directory = './Programs/'

# Get all Excel files in the directory
files = [f for f in os.listdir(directory) if os.path.isfile(os.path.join(directory, f)) and f.endswith('.xlsx')]

# Initialize an empty dictionary to hold the data
data = {}

# Process each file
for file in files:
    # Read the Excel file
    df = pd.read_excel(os.path.join(directory, file))

    # Get the university name from the file name
    university_name = os.path.splitext(file)[0]

    # Initialize a dictionary to hold the tracks
    tracks = {}

    # Process each column in the DataFrame
    for column in df.columns:
        # Convert the column values to strings and split by comma
        majors = df[column].dropna().astype(str).str.split(', ')

        # Add the majors to the track
        tracks[column] = [major for sublist in majors for major in sublist]

    # Check if the university is already in the data
    if university_name in data:
        # If it is, add the tracks to the existing university data
        data[university_name].update(tracks)
    else:
        # If it's not, add the university to the data with the tracks
        data[university_name] = tracks

# Convert the dictionary to JSON
json_data = json.dumps(data, indent=4)

# Write the JSON data to a file
with open('universities.json', 'w') as f:
    f.write(json_data)


import json

# Function to remove trailing colon and whitespace from keys in a nested dictionary
def clean_data(d):
    new = {}
    for k, v in d.items():
        new_k = k.rstrip(':').strip()
        if isinstance(v, dict):
            new[new_k] = clean_data(v)
        elif isinstance(v, list):
            new[new_k] = [clean_data(i) if isinstance(i, dict) else i.strip() for i in v]
        else:
            new[new_k] = v.strip()
    return new

# Open the JSON file and load the data
with open('universities.json', 'r') as f:
    data = json.load(f)

# Remove trailing colon and whitespace from keys and values
new_data = clean_data(data)

# Write the new data to the JSON file
with open('universities.json', 'w') as f:
    json.dump(new_data, f, indent=4)

import json

# Open the JSON file and load the data
with open('universities.json', 'r') as f:
    data = json.load(f)

# Initialize an empty dictionary to hold the new data
new_data = {}

# Process each key-value pair in the data
for key, value in data.items():
    # Split the key into the university name and the track
    university_name, track = key.split('_', 1)
    # Check if the university is already in the new data
    if university_name not in new_data:
        # If it's not, add the university to the new data with an empty dictionary for the tracks
        new_data[university_name] = {}

    # Add the track to the university data
    new_data[university_name][track] = value

# Write the new data to the JSON file
with open('universities2.json', 'w') as f:
    json.dump(new_data, f, indent=4)